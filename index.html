<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Mano Robótica 3D + Control de Voz</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body {margin:0;background:#0a0f1a;color:#e0e6ed;font-family:sans-serif;text-align:center;}
  h1{color:#06b6d4;margin:10px;}
  canvas{display:block;margin:auto;background:#060b10;border-radius:10px;}
  button{margin:10px;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;background:#06b6d4;color:#031015;font-weight:bold;}
</style>
</head>
<body>
<h1>Control Visual de Mano Robótica</h1>
<button id="voz"> Activar voz</button>
<div id="container" style="width:100%;height:500px;"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/OrbitControls.js"></script>

<script>
let scene, camera, renderer, controls, dedos=[];
init3D();
function init3D(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x060b10);
  camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(0,5,15);
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth*0.95, 500);
  document.getElementById("container").appendChild(renderer.domElement);
  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping=true;
  const luz = new THREE.DirectionalLight(0xffffff,1);
  luz.position.set(5,10,7); scene.add(luz);
  scene.add(new THREE.AmbientLight(0x404040,0.8));
  const palma = new THREE.Mesh(new THREE.BoxGeometry(6,0.8,4), new THREE.MeshStandardMaterial({color:0x06b6d4,roughness:0.7}));
  scene.add(palma);
  const sep=[-2.2,-1.1,0,1.2,2.4];
  for(let i=0;i<5;i++){
    const dedo = new THREE.Mesh(new THREE.BoxGeometry(0.6,2.4,0.6), new THREE.MeshStandardMaterial({color:0x9eeaf9}));
    dedo.position.set(sep[i],1.6,0);
    dedos.push(dedo); scene.add(dedo);
  }
  animate();
}
function animate(){
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene,camera);
}
function moverDedo(idx,angulo){
  dedos[idx].rotation.x = -angulo*Math.PI/180;
}

/* ===== Control de Voz ===== */
let rec=null, escuchando=false;
document.getElementById("voz").onclick=()=>{
  if(!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)){
    alert('Tu navegador no soporta reconocimiento de voz.');
    return;
  }
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!rec){
    rec = new SR();
    rec.lang='es-ES';
    rec.onresult=e=>{
      const t=e.results[0][0].transcript.toLowerCase();
      if(t.includes("cierra")) dedos.forEach((d,i)=>moverDedo(i,180));
      else if(t.includes("abre")) dedos.forEach((d,i)=>moverDedo(i,0));
      else alert("Comando no reconocido: "+t);
    };
  }
  if(!escuchando){rec.start(); escuchando=true; document.getElementById("voz").innerText="Escuchando...";}
  rec.onend=()=>{escuchando=false; document.getElementById("voz").innerText="Activar voz";}
};
</script>
</body>
</html>
